# 📢 广告发送功能使用指南

完整的广告管理系统，支持模板管理、定时发送和批量发送。

## 🎯 功能概览

- ✅ **广告模板管理** - 创建、编辑、删除广告模板
- ✅ **图片支持** 🆕 - 支持图片 + 文字 + 按钮组合
- ✅ **立即发送** - 批量发送广告到多个频道/群组
- ✅ **定时发送** - 创建定时任务，自动在指定时间发送
- ✅ **发送记录** - 查看所有广告发送历史
- ✅ **按钮支持** - 支持添加可点击按钮（如：立即购买）

**📸 新增图片功能！** 查看 [图片功能专题指南](PROMO_IMAGE_GUIDE.md)

## 📝 快速开始

### 1. 进入广告管理

管理员在 Bot 中发送命令：

```
/admin  → 点击"📢 广告管理"
```

或直接：

```
/promo
```

### 2. 创建广告模板

**步骤：**

1. 点击 **"➕ 创建广告模板"**
2. 输入模板名称（如：`月度促销`）
3. 📸 **发送图片**（可选，或发送 `-` 跳过）🆕
4. 输入广告内容（支持 emoji 和换行，有图片时可跳过）
5. 输入按钮文字（如：`💳 立即购买`），或发送 `-` 跳过
6. 输入按钮链接（如：`https://t.me/YourBot?start=promo`）

> 💡 **新功能**：现在可以添加图片！详见 [图片功能指南](PROMO_IMAGE_GUIDE.md)

**示例广告内容：**

```
🎉 加入我们的 VIP 专属频道！

专属内容、独家资源、优先服务

💰 优惠价格：
  月会员 68元
  年会员 588元

立即开始你的会员之旅！
```

### 3. 发送广告

#### 方式 A：立即发送

1. 点击 **"📤 立即发送广告"**
2. 选择要使用的模板
3. 输入目标频道/群组 ID

**目标格式：**
```
# 单个目标
@your_channel

# 或使用 ID
-1001234567890

# 多个目标（逗号分隔）
@channel1,@channel2,-1001234567890
```

#### 方式 B：定时发送

1. 点击 **"⏰ 创建定时任务"**
2. 选择要使用的模板
3. 输入目标频道/群组 ID（格式同上）
4. 输入发送时间（格式：`2025-10-28 14:30`）

**定时任务会在指定时间自动执行！**

## 🎨 广告模板示例

### 示例 1：简单广告（无按钮）

**模板名称：** `简单通知`

**广告内容：**
```
📢 重要通知

我们的服务已升级，欢迎体验新功能！

详情请联系管理员。
```

**按钮：** 发送 `-` 跳过

---

### 示例 2：带按钮的广告

**模板名称：** `VIP会员促销`

**广告内容：**
```
🎉 加入我们的 VIP 专属频道！

专属内容、独家资源、优先服务

💰 优惠价格：
  月会员 68元
  年会员 588元

立即开始你的会员之旅！
```

**按钮文字：** `💳 立即购买`

**按钮链接：** `https://t.me/YourBot?start=promo`

---

### 示例 3：活动宣传

**模板名称：** `双十一活动`

**广告内容：**
```
🔥 双十一特惠来袭！

所有套餐8折优惠
仅限本周末

📅 活动时间：11月11日-11月13日

不容错过的超值优惠！
```

**按钮文字：** `🛒 查看优惠`

**按钮链接：** `https://t.me/YourBot`

## 📋 管理功能

### 查看模板列表

点击 **"📝 查看模板列表"** 查看所有广告模板。

每个模板可以：
- 📤 **使用** - 立即发送
- ✏️ **编辑** - 修改内容（暂未实现，可删除后重建）
- 🗑️ **删除** - 删除模板

### 查看定时任务

点击 **"📋 查看任务列表"** 查看所有定时任务。

任务状态：
- ⏳ **待执行** - 等待时间到达
- ✅ **已完成** - 成功发送
- ❌ **失败** - 发送失败
- 🚫 **已取消** - 手动取消

可以取消待执行的任务。

### 查看发送记录

点击 **"📊 发送记录"** 查看最近20条发送历史。

记录包括：
- 发送时间
- 目标频道/群组
- 发送状态
- 错误信息（如果失败）

## 🔧 高级用法

### 批量发送到多个频道

输入目标时使用逗号分隔：

```
@channel1,@channel2,@channel3,-1001234567890
```

Bot 会自动发送到所有目标（每个目标间隔1秒，避免触发限制）。

### 定时发送多个任务

可以创建多个定时任务，在不同时间发送不同内容：

1. 创建任务 A：`2025-10-28 09:00` 发送早报
2. 创建任务 B：`2025-10-28 18:00` 发送晚报
3. 创建任务 C：`2025-10-28 20:00` 发送促销

所有任务会自动在指定时间执行。

### 获取频道/群组 ID

#### 方法 1：使用 @getidsbot

1. 搜索 `@getidsbot`
2. 将它添加到你的频道/群组
3. 复制显示的 ID

#### 方法 2：使用 @username

如果频道有公开用户名（如 `@mychannel`），可以直接使用 `@mychannel`。

#### 方法 3：转发消息

1. 从频道转发一条消息给 Bot
2. 查看消息详情，复制频道 ID

## ⚠️ 注意事项

### Bot 权限要求

要发送广告到频道/群组，Bot 必须：

1. ✅ 是频道/群组的**成员**
2. ✅ 有**发送消息**的权限
3. ✅ 对于频道，Bot 需要是**管理员**

### 发送限制

Telegram 对 Bot 有发送限制：

- 每秒最多发送 30 条消息
- 同一个群组每分钟最多 20 条消息

本系统已自动添加 1 秒延迟，避免触发限制。

### 推荐做法

1. **测试先行** - 先发送到测试频道，确认效果
2. **避免骚扰** - 不要频繁发送，建议每天不超过 3 次
3. **内容优质** - 提供有价值的内容，而非纯广告
4. **遵守规则** - 遵守 Telegram 使用条款

## 🐛 常见问题

### Q: 发送失败怎么办？

**A:** 检查以下几点：

1. Bot 是否在目标频道/群组中
2. Bot 是否有发送消息权限
3. 频道 ID 是否正确（包含 `-100` 前缀）
4. 按钮链接是否有效

查看 **"📊 发送记录"** 可以看到详细错误信息。

### Q: 如何修改已创建的模板？

**A:** 目前需要：

1. 删除旧模板
2. 创建新模板

### Q: 定时任务可以修改时间吗？

**A:** 目前不支持修改，需要：

1. 取消旧任务
2. 创建新任务

### Q: 可以发送图片吗？

**A:** 当前版本仅支持文字+按钮。图片功能待后续版本添加。

### Q: 发送记录可以导出吗？

**A:** 可以通过数据库查询：

```bash
python manage.py
# 在数据库中查询 promo_logs 表
```

## 📊 数据库结构

如果需要直接操作数据库：

### 表：promo_templates（广告模板）

| 字段 | 说明 |
|------|------|
| id | 模板 ID |
| name | 模板名称 |
| message | 广告内容 |
| button_text | 按钮文字 |
| button_url | 按钮链接 |
| created_by | 创建者 ID |
| is_active | 是否有效 |

### 表：scheduled_tasks（定时任务）

| 字段 | 说明 |
|------|------|
| id | 任务 ID |
| template_id | 模板 ID |
| target_chats | 目标列表 |
| scheduled_time | 发送时间 |
| status | 状态 |

### 表：promo_logs（发送记录）

| 字段 | 说明 |
|------|------|
| id | 记录 ID |
| template_id | 模板 ID |
| target_chat | 目标频道 |
| sent_at | 发送时间 |
| status | 成功/失败 |
| error_message | 错误信息 |

## 🎉 使用场景

### 场景 1：每日早报

创建模板 **"每日早报"**，设置定时任务每天 9:00 自动发送。

### 场景 2：限时促销

创建模板 **"限时优惠"**，立即发送到所有营销频道。

### 场景 3：新功能宣传

创建模板 **"新功能上线"**，发送到用户群组和频道。

### 场景 4：会员到期提醒

创建定时任务，在会员到期前 3 天发送续费提醒。

## 💡 最佳实践

1. **统一命名** - 模板名称清晰易懂（如：`2025-10-月度促销`）
2. **内容简洁** - 不超过 200 字，重点突出
3. **按钮明确** - 按钮文字清楚表明操作（如：`立即购买` 而非 `点我`）
4. **时间合理** - 选择用户活跃时段（如：9:00-22:00）
5. **测试为先** - 正式发送前先发送到测试频道

## 🚀 下一步

- 尝试创建你的第一个广告模板
- 发送测试广告到你的测试频道
- 设置定时任务自动发送

有问题随时查看本文档或联系开发者！

