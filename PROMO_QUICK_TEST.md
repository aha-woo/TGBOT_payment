# ⚡ 广告功能快速测试指南

5 分钟快速测试广告发送功能！

## 🎯 测试前准备

### 1. 创建测试频道

1. 在 Telegram 创建一个**私有测试频道**（如：`测试频道-勿扰`）
2. 把你的 Bot 添加为**管理员**
3. 获取频道 ID：
   - 搜索 `@getidsbot`
   - 把它添加到测试频道
   - 复制频道 ID（如：`-1001234567890`）

### 2. 确认你是管理员

确保你的 Telegram User ID 在 `.env` 文件的 `ADMIN_USER_IDS` 中。

查看你的 ID：
- 搜索 `@userinfobot`
- 发送 `/start`
- 复制你的 ID

## 🧪 测试步骤

### 测试 1: 创建广告模板（2分钟）

1. 在 Bot 中发送：`/promo`
2. 点击 **"➕ 创建广告模板"**
3. 输入模板名称：
   ```
   测试模板
   ```
4. 输入广告内容：
   ```
   🎉 这是一条测试广告！
   
   如果你能看到这条消息，说明广告功能正常工作。
   ```
5. 输入按钮文字：
   ```
   💳 点击测试
   ```
6. 输入按钮链接：
   ```
   https://t.me/your_bot_username
   ```

**预期结果：**
```
✅ 广告模板创建成功！

模板ID: 1
模板名称: 测试模板
按钮: 💳 点击测试 → https://t.me/your_bot_username

使用 /promo 管理广告
```

### 测试 2: 立即发送广告（1分钟）

1. 发送：`/promo`
2. 点击 **"📤 立即发送广告"**
3. 选择 **"测试模板"**
4. 输入你的测试频道 ID：
   ```
   -1001234567890
   ```
   (替换为你的实际频道 ID)

**预期结果：**
- Bot 回复：`📤 开始发送广告到 1 个目标...`
- 然后：
  ```
  ✅ 发送完成！

  成功: 1
  失败: 0

  使用 /promo 查看详细记录
  ```
- **在测试频道中看到广告消息！**

### 测试 3: 查看发送记录（30秒）

1. 发送：`/promo`
2. 点击 **"📊 发送记录"**

**预期结果：**
```
📊 最近发送记录：

✅ 测试模板
   目标: -1001234567890
   时间: 2025-10-27 15:30:45
```

### 测试 4: 批量发送（1分钟）

如果你有多个测试频道，测试批量发送：

1. 发送：`/promo`
2. 点击 **"📤 立即发送广告"**
3. 选择模板
4. 输入多个频道 ID（逗号分隔）：
   ```
   -1001234567890,@testchannel2,-1009876543210
   ```

**预期结果：**
- 按顺序发送到所有频道
- 显示成功和失败数量

### 测试 5: 定时发送（1分钟）

1. 发送：`/promo`
2. 点击 **"⏰ 创建定时任务"**
3. 选择 **"测试模板"**
4. 输入频道 ID：
   ```
   -1001234567890
   ```
5. 输入发送时间（2分钟后）：
   ```
   2025-10-27 15:35
   ```
   (替换为当前时间+2分钟)

**预期结果：**
```
✅ 定时任务创建成功！

任务ID: 1
发送时间: 2025-10-27 15:35
目标: -1001234567890

任务将在指定时间自动发送
```

**2分钟后：**
- 测试频道收到广告
- 你（管理员）收到通知：
  ```
  📢 定时广告任务完成

  任务ID: 1
  成功: 1
  失败: 0
  ```

## ✅ 测试清单

完成所有测试后，应该实现：

- [x] 创建广告模板
- [x] 立即发送广告
- [x] 查看发送记录
- [x] 批量发送（可选）
- [x] 定时发送
- [x] 定时任务自动执行

## 🐛 常见问题排查

### 问题 1: 发送失败

**错误：** `Chat not found`

**解决方案：**
1. 检查频道 ID 是否正确
2. 确认 Bot 在频道中
3. 确认频道 ID 包含 `-100` 前缀

---

**错误：** `Bot was blocked by the user`

**解决方案：**
- 如果是群组，确认 Bot 没有被踢出
- 如果是频道，确认 Bot 是管理员

---

**错误：** `Not enough rights to send messages`

**解决方案：**
- 确认 Bot 是频道**管理员**
- 确认 Bot 有**发送消息**权限

### 问题 2: 定时任务不执行

**可能原因：**
1. Bot 没有运行
2. 时间格式错误
3. 设置的时间已经过去

**排查步骤：**
1. 检查 Bot 日志：`tail -f bot.log`
2. 查看是否有错误信息
3. 确认定时任务检查器正在运行：
   ```
   # 日志中应该有：
   Scheduled task checker started (running every 60 seconds)
   ```

### 问题 3: 按钮不显示

**可能原因：**
- 创建模板时没有输入按钮信息
- 按钮链接格式错误

**解决方案：**
- 删除旧模板，重新创建
- 确保链接以 `http://` 或 `https://` 开头

## 📊 测试报告模板

测试完成后，可以记录：

```
广告发送功能测试报告

测试时间: 2025-10-27 15:30
测试人: @your_username

✅ 创建模板: 成功
✅ 立即发送: 成功
✅ 发送记录: 正常显示
✅ 批量发送: 成功 (2/2)
✅ 定时发送: 创建成功
✅ 自动执行: 按时执行

总结: 所有功能正常！
```

## 🚀 生产环境使用建议

测试通过后，生产环境使用时：

1. **创建正式模板**
   - 使用清晰的名称（如：`2025-10-月度促销`）
   - 精心编写广告内容
   - 测试按钮链接

2. **谨慎设置定时任务**
   - 仔细检查时间
   - 确认目标频道列表
   - 预留提前量（建议设置在5分钟后）

3. **监控发送结果**
   - 定期查看发送记录
   - 关注失败原因
   - 及时调整策略

4. **避免滥用**
   - 每天发送不超过 3 次
   - 避免深夜发送打扰用户
   - 提供有价值的内容

## 🎉 测试成功！

如果所有测试都通过，恭喜你！广告发送系统已经可以正常使用了。

接下来：
1. 阅读完整文档：[PROMO_GUIDE.md](PROMO_GUIDE.md)
2. 创建你的正式广告模板
3. 开始使用广告功能推广你的服务

祝您使用愉快！🚀

